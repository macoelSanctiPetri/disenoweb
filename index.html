<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fundamentos de Sistemas Numéricos - TIC 1º Bachillerato</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --primary: #2563eb; /* Azul */
            --secondary: #16a34a; /* Verde */
            --tertiary: #f59e0b; /* Naranja */
            --quaternary: #9333ea; /* Morado */
            --quinary: #e11d48; /* Rosa */
            
            /* Variables Escalera */
            --box-size: 60px;
            --ladder-border-color: #f97316; 
            --ladder-border-width: 3px;
        }

        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .math-mono { font-family: 'Roboto Mono', monospace; }
        sup { font-size: 0.7em; vertical-align: super; }

        /* --- ESTILOS COMUNES --- */
        .intro-cell {
            height: 50px; width: 50px; display: flex; align-items: center; justify-content: center;
            font-family: 'Roboto Mono', monospace; font-size: 1.5rem; font-weight: 700;
            background-color: white; border-width: 3px; border-style: solid; border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); transition: transform 0.2s;
        }
        .intro-cell:hover { transform: translateY(-3px); }
        
        .cell-dec { border-color: var(--primary); color: var(--primary); }
        .cell-bin { border-color: var(--secondary); color: var(--secondary); }
        .cell-oct { border-color: var(--quaternary); color: var(--quaternary); }
        .cell-hex { border-color: var(--quinary); color: var(--quinary); }

        /* --- VISUALIZADORES --- */
        .viz-container {
            height: 500px; display: flex; flex-direction: column; border: 1px solid #e2e8f0;
            border-radius: 0.5rem; background: white; overflow: hidden;
        }
        .viz-header {
            color: white; padding: 10px; display: flex; justify-content: center;
            font-family: 'Roboto Mono', monospace; font-size: 0.85rem;
        }
        .header-cell {
            display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
            width: 30px; margin: 0 1px; text-align: center;
        }
        .header-value { color: #e2e8f0; font-size: 0.7rem; margin-top: 2px; opacity: 0.9; }
        .viz-content { flex: 1; overflow-y: auto; padding: 10px; text-align: center; }
        .viz-row {
            font-family: 'Roboto Mono', monospace; font-size: 1.2rem; margin: 0; padding: 0;
            display: flex; justify-content: center; line-height: 1.5;
        }
        .digit-span { display: inline-flex; align-items: center; justify-content: center; width: 30px; height: 100%; text-align: center; }
        
        .bg-block-uniform { background-color: #eff6ff; color: #1d4ed8; font-weight: bold; }
        .bg-block-uniform-bin { background-color: #f0fdf4; color: #15803d; font-weight: bold; }
        .bg-block-uniform-oct { background-color: #faf5ff; color: #7e22ce; font-weight: bold; }
        .bg-block-uniform-hex { background-color: #fff1f2; color: #be123c; font-weight: bold; }

        /* --- TABLAS DE REFERENCIA --- */
        .ref-table-container {
            max-height: 300px; overflow-y: auto; border: 1px solid #e2e8f0;
            border-radius: 0.5rem; background: white; width: fit-content; margin: 0 auto;
            min-width: 300px;
        }
        .ref-row {
            display: grid; gap: 15px; padding: 4px 15px; border-bottom: 1px solid #f1f5f9;
            font-family: 'Roboto Mono', monospace; font-size: 0.85rem;
            cursor: pointer; transition: background-color 0.1s; align-items: center;
        }
        .ref-row:hover { background-color: #f8fafc; }
        .ref-row.active-row { background-color: #fef08a; color: #854d0e; font-weight: bold; border-left: 4px solid #eab308; }

        /* --- ESCALERA --- */
        .ladder-container-wrapper {
            font-family: 'Roboto Mono', monospace; overflow-x: auto;
            padding-bottom: 20px; padding-left: 10px; text-align: center; 
        }
        .number-cell {
            height: var(--box-size); min-width: var(--box-size); width: var(--box-size);
            padding: 0 15px; display: flex; align-items: center; justify-content: flex-end; 
            font-size: 1.5rem; font-weight: 700; color: #1f2937;
            box-sizing: border-box; background-color: white; flex-shrink: 0;
        }
        .divisor-cell {
            border-left-width: var(--ladder-border-width);
            border-left-style: solid;
            border-bottom-width: var(--ladder-border-width);
            border-bottom-style: solid;
            justify-content: center; position: relative; z-index: 20;
        }
        .remainder-cell { color: #dc2626; font-weight: 800; position: relative; }
        .step-container { display: inline-flex; flex-direction: row; align-items: flex-start; }
        .column { display: flex; flex-direction: column; align-items: flex-start; }
        .next-step-wrapper { margin-top: calc(-1 * var(--ladder-border-width)); position: relative; z-index: 10; }
        .final-quotient { color: #9ca3af; opacity: 0.6; }
        .end-label {
            height: var(--box-size); display: flex; align-items: center; padding-left: 10px;
            font-size: 0.8rem; font-weight: bold; color: #16a34a; white-space: nowrap;
        }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; transform: translateY(-10px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        /* Inputs */
        input { width: 100%; padding: 8px; border: 2px solid #cbd5e1; border-radius: 6px; font-size: 1.1rem; text-align: center; }
        input:focus { outline: none; border-color: var(--primary); }
        .viz-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        
        /* Viz Single Line */
        .viz-single-line {
            display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 0.75rem; align-items: center;
            font-family: 'Roboto Mono', monospace; font-size: 1.125rem; padding-bottom: 5px;
            width: auto; max-width: 100%;
        }
    </style>
</head>
<body>

    <header class="sticky top-0 z-50 bg-slate-900 shadow-md border-b-4 border-blue-600">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-white">Sistemas de Numeración</h1>
            <nav class="hidden md:flex gap-2">
                <a href="#decimal" class="px-3 py-1 rounded bg-blue-900 text-blue-200 text-xs hover:bg-blue-800">Decimal</a>
                <a href="#binary" class="px-3 py-1 rounded bg-green-900 text-green-200 text-xs hover:bg-green-800">Binario</a>
                <a href="#octal" class="px-3 py-1 rounded bg-purple-900 text-purple-200 text-xs hover:bg-purple-800">Octal</a>
                <a href="#hexadecimal" class="px-3 py-1 rounded bg-rose-900 text-rose-200 text-xs hover:bg-rose-800">Hexadecimal</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 max-w-5xl space-y-20">

        <!-- 1. DECIMAL -->
        <section id="decimal" class="scroll-mt-24">
            <div class="flex items-center gap-3 mb-4">
                <span class="bg-blue-600 text-white w-8 h-8 flex items-center justify-center rounded-full font-bold">1</span>
                <h2 class="text-2xl font-bold text-slate-800">Sistema Decimal</h2>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8 border-l-4 border-blue-500">
                <h3 class="text-xl font-bold text-blue-800 mb-4">1.1 Alfabeto (10 Símbolos)</h3>
                <p class="text-slate-600 mb-6 text-sm leading-relaxed">
                    El <strong>Sistema Decimal</strong> utiliza los dígitos del 0 al 9. Es un sistema posicional de base 10.
                </p>
                <div class="viz-grid" id="decimalSymbols"></div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8">
                <h3 class="text-xl font-bold text-slate-800 mb-4">1.2 Combinatoria</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <label class="text-sm font-bold text-slate-700">Cifras:</label>
                        <input type="range" id="decRange" min="1" max="4" value="1" class="accent-blue-600" oninput="renderDecimalTable()">
                        <div id="decFormulaDisplay" class="mt-2 text-center"></div>
                    </div>
                    <div class="md:col-span-2">
                        <div class="viz-container">
                            <div class="viz-header !bg-blue-900" id="decTableHeader"></div>
                            <div class="viz-content" id="decTable"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow">
                <h3 class="text-xl font-bold text-slate-800 mb-4">1.3 Descomposición</h3>
                <div class="bg-slate-50 p-4 rounded flex flex-col md:flex-row items-center gap-4 justify-center">
                    <input type="number" id="decInput" value="342" class="w-32 text-3xl font-bold text-blue-700 text-center bg-white border-2 border-blue-200 rounded-lg p-2" oninput="updateDecimalViz()">
                    <div class="hidden md:block text-2xl text-slate-300">→</div>
                    <div id="decViz" class="viz-single-line justify-center"></div>
                </div>
            </div>
        </section>

        <!-- 2. BINARIO -->
        <section id="binary" class="scroll-mt-24">
            <div class="flex items-center gap-3 mb-4">
                <span class="bg-green-600 text-white w-8 h-8 flex items-center justify-center rounded-full font-bold">2</span>
                <h2 class="text-2xl font-bold text-slate-800">Sistema Binario</h2>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8 border-l-4 border-green-500">
                <h3 class="text-xl font-bold text-green-800 mb-4">2.1 Alfabeto (2 Símbolos)</h3>
                <p class="text-slate-600 mb-6 text-sm leading-relaxed">
                    El <strong>Sistema Binario</strong> usa base 2 (0 y 1). Es el lenguaje de los ordenadores.
                </p>
                <div class="flex justify-center gap-6">
                    <div class="intro-cell cell-bin">0</div><div class="intro-cell cell-bin">1</div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8">
                <h3 class="text-xl font-bold text-slate-800 mb-4">2.2 Combinatoria</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <label class="text-sm font-bold text-slate-700">Bits:</label>
                        <input type="range" id="binRange" min="1" max="8" value="3" class="accent-green-600" oninput="renderBinaryTable()">
                        <div id="binFormulaDisplay" class="mt-2 text-center"></div>
                    </div>
                    <div class="md:col-span-2">
                        <div class="viz-container">
                            <div class="viz-header !bg-green-900" id="binTableHeader"></div>
                            <div class="viz-content" id="binTable"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8">
                <h3 class="text-xl font-bold text-slate-800 mb-4">2.3 Binario a Decimal</h3>
                <div class="flex flex-col items-center">
                    <div id="binarySwitches" class="flex flex-wrap justify-center gap-2 mb-6"></div>
                    
                    <div class="w-full bg-slate-50 p-4 rounded-t-xl border border-slate-200 border-b-0 flex justify-center">
                        <div id="binToDecCalc" class="viz-single-line justify-center"></div>
                    </div>
                    <div class="w-full bg-slate-800 p-4 rounded-b-xl shadow-lg text-center mb-8">
                        <div class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-1">Resultado Decimal</div>
                        <div id="binToDecResult" class="text-4xl font-mono font-bold text-green-400"></div>
                    </div>

                    <div class="w-full border-t pt-6 text-center">
                        <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">Tabla Referencia (0-255)</h4>
                        <div class="ref-table-container custom-scroll">
                            <div class="bg-slate-100 px-5 py-2 flex text-xs font-bold text-slate-500 sticky top-0 border-b border-slate-200" style="display: grid; grid-template-columns: 60px 1fr; gap: 20px;">
                                <span style="text-align: right;">DEC</span><span>BIN (8b)</span>
                            </div>
                            <div id="refTableBodyBin"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow border-l-4 border-green-500">
                <h3 class="text-xl font-bold text-green-900 mb-4">2.4 Decimal a Binario (Escalera)</h3>
                <div class="grid md:grid-cols-3 gap-6 items-start">
                    <div class="bg-green-50 p-4 rounded-xl">
                        <label class="block text-sm font-bold text-green-900 mb-2">Decimal:</label>
                        <input type="number" id="ladderInputBin" value="42" min="0" class="w-full text-center text-3xl font-bold text-green-700 border-2 border-green-200 rounded-lg p-2 mb-4" onkeypress="if(event.key === 'Enter') calculateLadderBin()">
                        <button onclick="calculateLadderBin()" class="w-full bg-green-600 text-white font-bold py-2 rounded shadow hover:bg-green-700 transition">Convertir</button>
                        <div class="hidden mt-4 bg-white p-2 rounded border border-green-100 text-center" id="ladderResBoxBin">
                            <div class="text-xs text-gray-400 uppercase font-bold tracking-wider">Binario</div>
                            <div id="ladderOutBin" class="text-3xl font-mono font-bold text-green-600 mt-1 break-all"></div>
                        </div>
                    </div>
                    <div class="md:col-span-2 bg-white border rounded-xl p-4 overflow-hidden min-h-[150px]">
                        <div class="ladder-container-wrapper">
                            <div id="ladderContBin" class="inline-block text-left pt-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. OCTAL -->
        <section id="octal" class="scroll-mt-24">
            <div class="flex items-center gap-3 mb-4">
                <span class="bg-purple-600 text-white w-8 h-8 flex items-center justify-center rounded-full font-bold">3</span>
                <h2 class="text-2xl font-bold text-slate-800">Sistema Octal</h2>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8 border-l-4 border-purple-500">
                <h3 class="text-xl font-bold text-purple-800 mb-4">3.1 Alfabeto Octal</h3>
                <p class="text-slate-600 mb-6 text-sm leading-relaxed">
                    El <strong>Sistema Octal</strong> usa base 8 (dígitos 0-7). Es útil porque cada dígito octal equivale exactamente a 3 bits.
                </p>
                <div class="viz-grid" id="octalSymbols"></div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8">
                <h3 class="text-xl font-bold text-slate-800 mb-4">3.2 Combinatoria</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <label class="text-sm font-bold text-slate-700">Cifras:</label>
                        <input type="range" id="octRange" min="1" max="4" value="2" class="accent-purple-600" oninput="renderOctalTable()">
                        <div id="octFormulaDisplay" class="mt-2 text-center"></div>
                    </div>
                    <div class="md:col-span-2">
                        <div class="viz-container">
                            <div class="viz-header !bg-purple-900" id="octTableHeader"></div>
                            <div class="viz-content" id="octTable"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8">
                <h3 class="text-xl font-bold text-slate-800 mb-4">3.3 Octal a Decimal</h3>
                <div class="bg-purple-50 p-4 rounded-xl flex flex-wrap items-center justify-center gap-4 mb-6">
                    <input type="text" id="octInput" value="75" class="w-32 text-3xl font-bold text-center text-purple-700 p-2 rounded bg-white border-2 border-purple-200 uppercase" oninput="this.value = this.value.replace(/[^0-7]/g, ''); updateOctalViz()">
                    <div class="text-2xl text-purple-300 font-bold">→</div>
                    <div id="octViz" class="viz-single-line"></div>
                </div>
                <div class="w-full border-t pt-6 text-center">
                     <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">Tabla Referencia</h4>
                     <div class="ref-table-container custom-scroll">
                        <div class="bg-slate-100 px-5 py-2 flex text-xs font-bold text-slate-500 sticky top-0 border-b border-slate-200" style="display: grid; grid-template-columns: 60px 80px 1fr; gap: 15px;">
                            <span style="text-align: right;">DEC</span><span class="text-center">OCT</span><span>BIN</span>
                        </div>
                        <div id="refTableBodyOct"></div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow border-l-4 border-purple-500 mb-8">
                <h3 class="text-xl font-bold text-purple-900 mb-4">3.4 Decimal a Octal (Escalera)</h3>
                <div class="grid md:grid-cols-3 gap-6 items-start">
                    <div class="bg-purple-50 p-4 rounded-xl">
                        <label class="block text-sm font-bold text-purple-900 mb-2">Decimal:</label>
                        <input type="number" id="ladderInputOct" value="100" min="0" class="w-full text-center p-3 text-3xl font-bold text-purple-700 border-2 border-purple-200 rounded-lg mb-4" onkeypress="if(event.key === 'Enter') calculateLadderOct()">
                        <button onclick="calculateLadderOct()" class="w-full bg-purple-600 text-white font-bold py-2 rounded shadow hover:bg-purple-700 transition">Convertir</button>
                        <div class="hidden mt-4 bg-white p-2 rounded border border-purple-100 text-center" id="ladderResBoxOct">
                            <div class="text-xs text-gray-400 uppercase font-bold tracking-wider">Octal</div>
                            <div id="ladderOutOct" class="text-3xl font-mono font-bold text-purple-600 mt-1 break-all"></div>
                        </div>
                    </div>
                    <div class="md:col-span-2 bg-white border rounded-xl p-4 overflow-hidden min-h-[150px]">
                        <div class="ladder-container-wrapper">
                            <div id="ladderContOct" class="inline-block text-left pt-2"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
                <h3 class="text-xl font-bold text-purple-900 mb-4">3.5 Binario a Octal (Agrupación)</h3>
                <p class="text-slate-600 mb-6 text-sm">Como 2<sup>3</sup>=8, agrupamos bits de 3 en 3.</p>
                <div class="bg-purple-50 p-6 rounded-xl flex flex-col items-center gap-6">
                    <div class="flex flex-col md:flex-row items-center gap-4 w-full justify-center">
                        <div>
                            <input type="text" id="binToOctInput" value="10110111" class="w-64 text-center p-3 text-2xl font-mono font-bold text-green-600 border-2 border-green-200 rounded-lg focus:border-green-500" oninput="this.value = this.value.replace(/[^01]/g, ''); updateBinToOctGroupViz()">
                            <p class="text-xs text-slate-400 text-center mt-1">Solo 0 y 1</p>
                        </div>
                        <div class="text-3xl text-purple-300 hidden md:block">→</div>
                        <div id="binToOctDisplay" class="text-2xl font-mono font-bold text-slate-500 tracking-widest"></div>
                    </div>
                    <div id="binToOctViz" class="w-full flex flex-wrap justify-center gap-6 min-h-[100px]"></div>
                </div>
            </div>
        </section>

        <!-- 4. HEXADECIMAL -->
        <section id="hexadecimal" class="scroll-mt-24">
            <div class="flex items-center gap-3 mb-6">
                <span class="bg-rose-600 text-white w-10 h-10 flex items-center justify-center rounded-full font-bold">4</span>
                <h2 class="text-3xl font-bold text-slate-800">Sistema Hexadecimal</h2>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8 border-l-4 border-rose-500">
                <h3 class="text-xl font-bold text-rose-800 mb-4">4.1 Alfabeto Hexadecimal</h3>
                <p class="text-slate-600 mb-6 text-sm leading-relaxed">
                    El <strong>Sistema Hexadecimal</strong> tiene base 16. Usa 0-9 y letras <strong>A-F</strong> (10-15). Se usa para representar colores y memoria.
                </p>
                <div class="viz-grid" id="hexSymbols"></div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8">
                <h3 class="text-xl font-bold text-slate-800 mb-4">4.2 Combinatoria</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-rose-50 p-4 rounded-lg">
                        <label class="text-sm font-bold text-slate-700">Cifras:</label>
                        <input type="range" id="hexRange" min="1" max="3" value="2" class="accent-rose-600" oninput="renderHexTable()">
                        <div id="hexFormulaDisplay" class="mt-2 text-center"></div>
                    </div>
                    <div class="md:col-span-2">
                        <div class="viz-container">
                            <div class="viz-header !bg-rose-900" id="hexTableHeader"></div>
                            <div class="viz-content" id="hexTable"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow mb-8">
                <h3 class="text-xl font-bold text-slate-800 mb-4">4.3 Hexadecimal a Decimal</h3>
                <div class="bg-rose-50 p-6 rounded-xl flex flex-wrap items-center justify-center gap-4 mb-6">
                     <input type="text" id="hexInput" value="1A" class="w-32 text-3xl font-bold text-center text-rose-700 uppercase p-2 rounded bg-white border-2 border-rose-200" oninput="this.value = this.value.replace(/[^0-9A-Fa-f]/g, '').toUpperCase(); updateHexViz()">
                     <div class="hidden md:block text-2xl text-rose-300">→</div>
                    <div id="hexViz" class="viz-single-line"></div>
                </div>
                <div class="w-full border-t pt-6 text-center mt-6">
                     <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">Tabla Maestra (0-255)</h4>
                     <div class="ref-table-container custom-scroll" style="max-width: 600px;">
                        <div class="bg-slate-100 px-5 py-2 flex text-xs font-bold text-slate-500 sticky top-0 border-b border-slate-200" style="display: grid; grid-template-columns: 60px 60px 60px 1fr; gap: 10px;">
                            <span style="text-align: right;">DEC</span><span class="text-center">HEX</span><span class="text-center">OCT</span><span>BIN</span>
                        </div>
                        <div id="refTableBodyHex"></div>
                    </div>
                </div>
            </div>
            <!-- 4.4 NUEVO: Conversión Binario a Hexadecimal -->
            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-rose-500">
                <h3 class="text-xl font-bold text-rose-900 mb-4">4.4 Binario a Hexadecimal (Agrupación)</h3>
                <p class="text-slate-600 mb-6 text-sm">Como 2<sup>4</sup>=16, agrupamos bits de 4 en 4.</p>
                <div class="bg-rose-50 p-6 rounded-xl flex flex-col items-center gap-6">
                    <div class="flex flex-col md:flex-row items-center gap-4 w-full justify-center">
                        <div>
                            <input type="text" id="binToHexInput" value="10110111" class="w-64 text-center p-3 text-2xl font-mono font-bold text-green-600 border-2 border-green-200 rounded-lg focus:border-green-500" oninput="this.value = this.value.replace(/[^01]/g, ''); updateBinToHexGroupViz()">
                            <p class="text-xs text-slate-400 text-center mt-1">Solo 0 y 1</p>
                        </div>
                        <div class="text-3xl text-rose-300 hidden md:block">→</div>
                        <div id="binToHexDisplay" class="text-2xl font-mono font-bold text-slate-500 tracking-widest"></div>
                    </div>
                    <div id="binToHexViz" class="w-full flex flex-wrap justify-center gap-6 min-h-[100px]"></div>
                </div>
            </div>
        </section>
    </main>

    <script>
        function el(id) { return document.getElementById(id); }

        // --- GENÉRICOS ---
        function renderSymbols(id, chars, cls) { el(id).innerHTML = chars.map(c => `<div class="intro-cell ${cls}">${c}</div>`).join(''); }
        
        function renderBaseTable(base, rid, fid, hid, tid, bgCls, colHex) {
            const d = parseInt(el(rid).value), tot = Math.pow(base, d);
            el(fid).innerHTML = `<div class="text-sm text-slate-500">Posibilidades</div><div class="text-2xl font-mono font-bold" style="color:${colHex}">${base}<sup>${d}</sup> = ${tot.toLocaleString()}</div>`;
            let h='', t='', bs=Math.pow(base, Math.max(1,d-1));
            for(let i=d-1; i>=0; i--) h+=`<div class="header-cell"><div>${base}<sup>${i}</sup></div><div class="header-value">${Math.pow(base,i).toLocaleString()}</div></div>`;
            el(hid).innerHTML = h;
            const lim = Math.min(tot, 256);
            for(let n=0; n<lim; n++) {
                let s=n.toString(base).toUpperCase().padStart(d,'0'), row='', isNB=(n>0 && n%bs===0);
                for(let i=0; i<s.length; i++) {
                    let bg = (d>1 && i>0) ? bgCls : '';
                    if(bg && n%bs===0) bg+=' rounded-t-md'; if(bg && (n+1)%bs===0) bg+=' rounded-b-md';
                    row+=`<span class="digit-span ${bg}" style="color:${(d>1&&i>0)?colHex:'#64748b'}; font-weight:bold">${s[i]}</span>`;
                }
                t+=`<div class="viz-row ${isNB?'pt-4':''}">${row}</div>`;
            }
            if(tot>lim) t+=`<div class="text-xs text-slate-400 py-2">...</div>`;
            el(tid).innerHTML = t;
        }

        function updatePolyViz(iid, vid, base, col) {
            const v = el(iid).value.toUpperCase();
            if(!v) { el(vid).innerHTML=''; return; }
            let h='', tot=0;
            for(let i=0; i<v.length; i++) {
                let val=parseInt(v[i], base), pow=v.length-1-i; tot+=val*Math.pow(base,pow);
                let disp = (base===16 && val>=10) ? `${v[i]}<span class="text-xs opacity-60">(${val})</span>` : v[i];
                h+=`<div class="bg-white border rounded px-2 py-1 shadow-sm flex items-baseline gap-1 shrink-0"><span style="color:${col}; font-weight:bold">${disp}</span><span class="text-xs text-slate-400">x</span><span class="text-slate-600 font-bold">${base}<sup>${pow}</sup></span></div>`;
                if(i<v.length-1) h+=`<span class="text-slate-300 font-bold">+</span>`;
            }
            h+=`<span class="mx-2 text-slate-300">=</span><strong class="text-slate-800 text-2xl">${tot}</strong>`;
            el(vid).innerHTML = h;
            if(base===2) highlightRow(tot, 'refTableBodyBin', 'bin');
            if(base===8) highlightRow(tot, 'refTableBodyOct', 'oct');
            if(base===16) highlightRow(tot, 'refTableBodyHex', 'hex');
        }

        // --- TABLAS REF ---
        function renderRefTables() {
            let bHtml = '';
            for(let i=0; i<=255; i++) bHtml += `<div id="bin-row-${i}" class="ref-row" style="grid-template-columns: 60px 1fr; gap: 20px;"><span>${i}</span><span class="font-bold text-slate-700">${i.toString(2).padStart(8,'0')}</span></div>`;
            el('refTableBodyBin').innerHTML = bHtml;
            let oHtml = '';
            for(let i=0; i<=63; i++) oHtml += `<div id="oct-row-${i}" class="ref-row" style="grid-template-columns: 60px 80px 1fr; gap: 15px;"><span style="text-align:right">${i}</span><span class="text-center font-bold text-purple-600">${i.toString(8)}</span><span class="text-slate-500">${i.toString(2).padStart(6,'0')}</span></div>`;
            el('refTableBodyOct').innerHTML = oHtml;
            let hHtml = '';
            for(let i=0; i<=255; i++) hHtml += `<div id="hex-row-${i}" class="ref-row" style="grid-template-columns: 60px 60px 60px 1fr; gap: 10px;"><span style="text-align:right">${i}</span><span class="text-center font-bold text-rose-600">${i.toString(16).toUpperCase()}</span><span class="text-center text-purple-600">${i.toString(8)}</span><span class="text-slate-500">${i.toString(2).padStart(8,'0')}</span></div>`;
            el('refTableBodyHex').innerHTML = hHtml;
        }
        function highlightRow(n, tid, p) {
            const t=el(tid); if(!t) return;
            const a=t.querySelector('.active-row'); if(a) a.classList.remove('active-row');
            const r=document.getElementById(`${p}-row-${n}`);
            if(r) { r.classList.add('active-row'); r.scrollIntoView({behavior:'smooth', block:'center'}); }
        }

        // --- ESCALERA GENÉRICA ---
        function drawLadderGeneric(base, iid, cid, oid, boxid, colPrime, colLight) {
            const inp=el(iid), cont=el(cid), resBox=el(boxid), out=el(oid);
            let n=parseInt(inp.value);
            cont.innerHTML=''; resBox.classList.add('hidden');
            if(isNaN(n)||n<0) return;
            if(n===0) { cont.innerHTML='<div class="text-2xl font-bold text-slate-400">0</div>'; out.innerText="0"; resBox.classList.remove('hidden'); return; }
            
            document.documentElement.style.setProperty('--ladder-border-color', colPrime);
            const rems=[];
            drawStep(n, cont, rems, base, colPrime, colLight);
            out.innerText = rems.reverse().map(r=>r.toString(16).toUpperCase()).join('');
            resBox.classList.remove('hidden');
        }

        function drawStep(div, parent, rems, base, colP, colL) {
            const q=Math.floor(div/base), r=div%base; rems.push(r);
            const remDisp = (base===16 && r>=10) ? r.toString(16).toUpperCase() : r;
            const sc=document.createElement('div'); sc.className='step-container fade-in';
            sc.style.animationDelay=`${rems.length*0.1}s`;
            
            const lc=document.createElement('div'); lc.className='column';
            const dc=document.createElement('div'); dc.className='number-cell'; dc.innerText=div;
            const rc=document.createElement('div'); rc.className='number-cell remainder-cell'; rc.innerText=remDisp;
            lc.append(dc, rc);

            const ric=document.createElement('div'); ric.className='column';
            const dvc=document.createElement('div'); dvc.className='number-cell divisor-cell'; 
            dvc.style.borderColor=colP; dvc.style.color=colP; dvc.innerText=base;
            const nsc=document.createElement('div'); nsc.className='next-step-wrapper';
            ric.append(dvc, nsc);

            sc.append(lc, ric); parent.append(sc);

            if(q>0) drawStep(q, nsc, rems, base, colP, colL);
            else {
                const fd=document.createElement('div'); fd.className='step-container fade-in';
                fd.style.animationDelay=`${(rems.length+1)*0.1}s`;
                const fl=document.createElement('div'); fl.className='column';
                const zc=document.createElement('div'); zc.className='number-cell final-quotient'; zc.innerText='0';
                fl.append(zc);
                const elbl=document.createElement('div'); elbl.className='end-label'; elbl.innerText='Fin división';
                fd.append(fl, elbl); nsc.append(fd);
            }
        }

        // --- 3.5/4.4 AGRUPACIÓN (OCT/HEX) ---
        function updateBinToOctGroupViz() { renderGrouping(3, 'binToOctInput', 'binToOctDisplay', 'binToOctViz', 'purple'); }
        function updateBinToHexGroupViz() { renderGrouping(4, 'binToHexInput', 'binToHexDisplay', 'binToHexViz', 'rose'); }

        function renderGrouping(size, iid, did, vid, colorTheme) {
            let binStr = el(iid).value.replace(/[^01]/g, '');
            const container = el(vid);
            const disp = el(did);
            
            if (!binStr) { container.innerHTML = ''; disp.innerText=''; return; }

            const rem = binStr.length % size;
            const pad = rem === 0 ? 0 : size - rem;
            const padded = '0'.repeat(pad) + binStr;
            
            let groups = [];
            for (let i = 0; i < padded.length; i += size) groups.push(padded.substr(i, size));
            disp.innerText = groups.join('-');

            let html = '';
            groups.forEach((group, idx) => {
                const val = parseInt(group, 2);
                const digit = val.toString(16).toUpperCase();
                const isPad = idx === 0 && pad > 0;
                
                html += `<div class="flex flex-col items-center gap-2">`;
                html += `<div class="flex border-2 border-${colorTheme}-200 rounded-lg overflow-hidden bg-white shadow-sm">`;
                for (let j = 0; j < size; j++) {
                    let bit = group[j];
                    let pBit = isPad && j < pad;
                    let cl = pBit ? 'text-gray-300 bg-gray-50' : 'text-slate-700 font-bold';
                    html += `<div class="w-6 h-10 flex items-center justify-center border-r border-${colorTheme}-100 last:border-r-0 ${cl}">${bit}</div>`;
                }
                html += `</div><div class="text-${colorTheme}-300"><i data-lucide="arrow-down" class="w-4 h-4"></i></div>`;
                html += `<div class="w-10 h-10 rounded-full bg-${colorTheme}-100 text-${colorTheme}-700 flex items-center justify-center font-bold text-xl shadow-sm border border-${colorTheme}-200">${digit}</div></div>`;
            });
            
            const res = parseInt(padded, 2).toString(16).toUpperCase();
            const label = size===3?'Octal':'Hex';
            html = `<div class="flex flex-wrap gap-4 justify-center items-end font-mono w-full">${html}</div>`;
            html += `<div class="w-full text-center mt-6 pt-4 border-t border-${colorTheme}-100 flex justify-center items-center gap-3"><span class="text-slate-500 text-sm font-bold uppercase tracking-wider">Resultado ${label}</span><span class="text-4xl font-mono font-bold text-${colorTheme}-600">${res}</span></div>`;
            container.innerHTML = html;
            lucide.createIcons();
        }

        // --- INITS ---
        renderSymbols('decimalSymbols', '0123456789'.split(''), 'cell-dec');
        function renderDecimalTable() { renderBaseTable(10, 'decRange', 'decFormulaDisplay', 'decTableHeader', 'decTable', 'bg-block-uniform', '#2563eb'); }
        function updateDecimalViz() { updatePolyViz('decInput', 'decViz', 10, '#2563eb'); }
        renderDecimalTable(); updateDecimalViz();

        function renderBinaryTable() { renderBaseTable(2, 'binRange', 'binFormulaDisplay', 'binTableHeader', 'binTable', 'bg-block-uniform-bin', '#16a34a'); }
        let binaryBits=[0,0,0,1,0,1,0,1];
        function renderBinaryLab() {
            const c=el('binarySwitches'), calc=el('binToDecCalc'), res=el('binToDecResult'); c.innerHTML=''; let sum=0, parts=[];
            const cols=['#2563eb','#dc2626','#16a34a'];
            binaryBits.forEach((b,i)=>{
                const p=7-i, v=Math.pow(2,p), col=cols[p%3], act=b===1;
                if(act) sum+=v;
                const btn=document.createElement('button');
                btn.className=`flex flex-col items-center group transition-all ${act?'-translate-y-2':'opacity-60 hover:opacity-100'}`;
                btn.onclick=()=>{binaryBits[i]=1-binaryBits[i]; renderBinaryLab();};
                btn.innerHTML=`<span class="text-[10px] font-bold text-slate-400 mb-1">2<sup>${p}</sup></span><div class="w-10 h-14 rounded border-2 flex flex-col items-center justify-between py-1 shadow-sm transition-colors ${act?'bg-green-50 border-green-500':'bg-white border-slate-300'}"><span class="text-[10px] text-slate-500">${v}</span><span class="text-xl font-mono font-bold ${act?'text-green-600':'text-slate-300'}">${b}</span></div>`;
                c.append(btn);
                let style = act ? `color:${col}; font-weight:bold;` : `opacity:0.4;`;
                parts.push(`<div class="bg-white border rounded px-2 py-1 shadow-sm flex items-baseline gap-1 shrink-0" style="${style}"><span style="color:${col};font-weight:bold">${b}</span><span class="text-xs text-slate-400">x</span><span class="text-slate-600 font-bold">2<sup>${p}</sup></span></div>`);
            });
            calc.innerHTML = parts.join('<span class="text-slate-300 mx-2">+</span>');
            res.innerText = sum;
            highlightRow(sum, 'refTableBodyBin', 'bin');
        }
        renderBinaryTable(); renderBinaryLab();
        function calculateLadderBin() { drawLadderGeneric(2, 'ladderInputBin', 'ladderContBin', 'ladderOutBin', 'ladderResBoxBin', '#16a34a', '#f0fdf4'); }
        calculateLadderBin();

        renderSymbols('octalSymbols', '01234567'.split(''), 'cell-oct');
        function renderOctalTable() { renderBaseTable(8, 'octRange', 'octFormulaDisplay', 'octTableHeader', 'octTable', 'bg-block-uniform-oct', '#9333ea'); }
        function updateOctalViz() { updatePolyViz('octInput', 'octViz', 8, '#9333ea'); }
        renderOctalTable(); updateOctalViz();
        function calculateLadderOct() { drawLadderGeneric(8, 'ladderInputOct', 'ladderContOct', 'ladderOutOct', 'ladderResBoxOct', '#9333ea', '#faf5ff'); }
        calculateLadderOct();
        updateBinToOctGroupViz();

        renderSymbols('hexSymbols', '0123456789ABCDEF'.split(''), 'cell-hex');
        function renderHexTable() { renderBaseTable(16, 'hexRange', 'hexFormulaDisplay', 'hexTableHeader', 'hexTable', 'bg-block-uniform-hex', '#e11d48'); }
        function updateHexViz() { updatePolyViz('hexInput', 'hexViz', 16, '#e11d48'); }
        renderHexTable(); updateHexViz();
        updateBinToHexGroupViz(); // Init 4.4

        renderRefTables();

    </script>
</body>
</html>
